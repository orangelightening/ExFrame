 Autonomous web scraping with stealth and resilience.

  3.1 Stealth Techniques
  ┌─────────────────────┬──────────────────────────────────────────────┬─────────────────────────────┐
  │      Technique      │                Implementation                │           Purpose           │
  ├─────────────────────┼──────────────────────────────────────────────┼─────────────────────────────┤
  │ Rate limiting       │ Exponential backoff, randomized delays       │ Avoid detection             │
  ├─────────────────────┼──────────────────────────────────────────────┼─────────────────────────────┤
  │ User agent rotation │ Pool of realistic browser UAs                │ Appear as different clients │
  ├─────────────────────┼──────────────────────────────────────────────┼─────────────────────────────┤
  │ Proxy rotation      │ Optional proxy pool for distributed requests │ Avoid IP blocking           │
  ├─────────────────────┼──────────────────────────────────────────────┼─────────────────────────────┤
  │ Request jitter      │ Random timing within acceptable range        │ Defeat pattern detection    │
  ├─────────────────────┼──────────────────────────────────────────────┼─────────────────────────────┤
  │ Warm-up             │ Gradual increase from cold start             │ Mimic human behavior        │
  └─────────────────────┴──────────────────────────────────────────────┴─────────────────────────────┘
  3.2 Error Handling

  class ScrapingErrorStrategy:
      ERROR_RESPONSES = {
          404: 'skip',  # Resource doesn't exist, move on
          403: 'backoff_and_retry',  # Rate limited, wait
          429: 'exponential_backoff',  # Explicit rate limit
          500: 'retry_with_care',  # Server error, cautious retry
          503: 'backoff_long',  # Service unavailable, wait longer
      }

      async def handle_error(self, error, url, attempt):
          strategy = self.ERROR_RESPONSES.get(error.status, 'skip')
          match strategy:
              case 'skip':
                  logger.warning(f"Skipping {url}: {error.status}")
                  return SkipAction()
              case 'backoff_and_retry':
                  return BackoffAction(delay=2 ** attempt)
              case 'exponential_backoff':
                  return BackoffAction(delay=min(2 ** attempt * 5, 300))
              # ... more strategies

  3.3 Scraping Supervisor

  class ScrapingSupervisor:
      async def orchestrate_scraping(self, targets: List[ScrapeTarget]):
          """Manage multiple scraping workers with coordination"""
          queue = asyncio.Queue()

          # Enqueue targets with priority
          for target in targets:
              await queue.put(target)

          # Spawn workers
          workers = [
              asyncio.create_task(self._worker(queue, i))
              for i in range(self.concurrency)
          ]

          # Supervise
          await asyncio.gather(*workers)

  ---
  4. Pattern Ingestion Pipeline

  From raw scrape to certified pattern.

  Raw HTML
     │
     ▼
  Extract → Structured Data (JSON candidate)
     │
     ▼
  Validate → Schema check, required fields
     │
     ▼
  De-duplicate → Similarity check against existing
     │
     ├──────────────┐
     ▼              ▼
  New       Duplicate → Merge/Update
     │
     ▼
  Certification Panel → Multi-AI review
     │
     ├────────┼────────┐
     ▼        ▼        ▼
  Certified Flagged Rejected
     │
     ▼
  Knowledge Base

  ---
  Human Intervention Points

  Current (High Intervention)

  - Manual pattern review
  - Manual scrape triggering
  - Manual data cleanup
  - Manual duplicate resolution
  - Manual error recovery

  Target (Minimal Intervention)
  ┌────────────────────┬──────────────────────────────┬───────────────────────┬───────────────────────────────┐
  │       Point        │          Automation          │     Human Trigger     │         Human Action          │
  ├────────────────────┼──────────────────────────────┼───────────────────────┼───────────────────────────────┤
  │ Source selection   │ AI discovers relevant        │ Strategic direction   │ "Focus on Python              │
  │                    │ sources                      │                       │ optimization"                 │
  ├────────────────────┼──────────────────────────────┼───────────────────────┼───────────────────────────────┤
  │ Scraping           │ Fully autonomous             │ N/A                   │ N/A                           │
  ├────────────────────┼──────────────────────────────┼───────────────────────┼───────────────────────────────┤
  │ Extraction         │ AI + validation              │ N/A                   │ N/A                           │
  ├────────────────────┼──────────────────────────────┼───────────────────────┼───────────────────────────────┤
  │ Certification      │ AI panel                     │ Low confidence alerts │ Review edge cases             │
  ├────────────────────┼──────────────────────────────┼───────────────────────┼───────────────────────────────┤
  │ Conflict           │ AI mediation                 │ Unresolvable          │ Arbitrate                     │
  │ resolution         │                              │ conflicts             │                               │
  ├────────────────────┼──────────────────────────────┼───────────────────────┼───────────────────────────────┤
  │ Quality audit      │ AI continuous                │ Scheduled             │ Review reports                │
  ├────────────────────┼──────────────────────────────┼───────────────────────┼───────────────────────────────┤
  │ System failure     │ AI recovery                  │ Critical failures     │ Root cause analysis           │
  └────────────────────┴──────────────────────────────┴───────────────────────┴───────────────────────────────┘
  Estimated Human Touch
  ┌───────────────┬─────────┬────────┬───────────┐
  │     Phase     │ Current │ Target │ Reduction │
  ├───────────────┼─────────┼────────┼───────────┤
  │ Ingestion     │ 100%    │ <1%    │ 99%       │
  ├───────────────┼─────────┼────────┼───────────┤
  │ Certification │ 100%    │ <5%    │ 95%       │
  ├───────────────┼─────────┼────────┼───────────┤
  │ Maintenance   │ 100%    │ <10%   │ 90%       │
  ├───────────────┼─────────┼────────┼───────────┤
  │ Overall       │ 100%    │ <5%    │ 95%       │
  └───────────────┴─────────┴────────┴───────────┘
  ---
  AI Supervisor Implementation

  Test Phase (Claude Code)

  # Current test setup uses Claude Code directly
  supervisor = ClaudeCodeSupervisor()
  supervisor.monitor_system()

  Production Phase (Generic Interface)

  # Production uses generic API endpoint
  supervisor = GenericSupervisor(
      api_url="https://api.example.com/v1",
      api_key=os.getenv["SUPERVISOR_API_KEY"]
  )

  # Supervisor is LLM-agnostic
  # Can use OpenAI, Anthropic, or any compatible API

  Supervisor State Machine

                      ┌─────────────┐
                      │   IDLE      │
                      └──────┬──────┘
                             │
                     Task assigned
                             ▼
                      ┌─────────────┐
                      │  MONITORING │◄─────────┐
                      └──────┬──────┘          │
                             │                 │
                  ┌──────────┼──────────┐      │
                  ▼          ▼          ▼      │
              Normal    Drift    Failure      │
                  │          │          │      │
                  │          ▼          │      │
                  │    Refocus          │      │
                  │          │          │      │
                  └──────────┴──────────┘      │
                             │                 │
                      Task complete            │
                             ▼                 │
                      ┌─────────────┐          │
                      │  REPORTING  │──────────┘
                      └──────┬──────┘
                             │
                      ┌──────┴──────┐
                      ▼             ▼
                 Success        Learn
                      │             │
                      └──────┬──────┘
                             ▼
                      ┌─────────────┐
                      │   IDLE      │
                      └─────────────┘

  ---
  Failure Modes and Recovery

  Supervisor Failure
  ┌──────────────────┬───────────────────┬───────────────────────────────────┐
  │     Failure      │     Detection     │             Recovery              │
  ├──────────────────┼───────────────────┼───────────────────────────────────┤
  │ Supervisor crash │ Watchdog process  │ Restart supervisor, restore state │
  ├──────────────────┼───────────────────┼───────────────────────────────────┤
  │ API unreachable  │ Health check      │ Failover to backup API            │
  ├──────────────────┼───────────────────┼───────────────────────────────────┤
  │ Hallucination    │ Output validation │ Rollback, log incident            │
  └──────────────────┴───────────────────┴───────────────────────────────────┘
  Worker Failure
  ┌────────────────┬──────────────┬─────────────────────────────────┐
  │    Failure     │  Detection   │            Recovery             │
  ├────────────────┼──────────────┼─────────────────────────────────┤
  │ Worker crash   │ No heartbeat │ Restart worker, reassign task   │
  ├────────────────┼──────────────┼─────────────────────────────────┤
  │ Worker stuck   │ Timeout      │ Terminate, restart with context │
  ├────────────────┼──────────────┼─────────────────────────────────┤
  │ Output garbage │ Validation   │ Flag for human review           │
  └────────────────┴──────────────┴─────────────────────────────────┘
  Certification Failure
  ┌────────────────────┬───────────────────────┬────────────────────────────┐
  │      Failure       │       Detection       │          Recovery          │
  ├────────────────────┼───────────────────────┼────────────────────────────┤
  │ Judge disagreement │ Consensus < threshold │ Add fourth judge           │
  ├────────────────────┼───────────────────────┼────────────────────────────┤
  │ All judges reject  │ Unanimous rejection   │ Log pattern, skip          │
  ├────────────────────┼───────────────────────┼────────────────────────────┤
  │ Judge unavailable  │ API timeout           │ Use remaining judges, flag │
  └────────────────────┴───────────────────────┴────────────────────────────┘
  ---
  Configuration

  Supervisor Config

  supervisor:
    api:
      url: https://api.example.com/v1
      model: claude-3.5-sonnet
      max_tokens: 4096
      temperature: 0.7

    heartbeat:
      interval: 30  # seconds
      timeout: 10   # seconds
      max_missed: 3

    focus:
      window_size: 10  # messages to analyze
      drift_threshold: 0.3
      repetition_threshold: 0.95

    refocus:
      max_attempts: 3
      strategies: [gentle, context_reset, hard_reset]

  Certification Config

  certification:
    judges:
      - name: generalist
        model: gpt-4
        temperature: 0.3
        role: structure_review

      - name: specialist
        model: claude-3.5-sonnet
        temperature: 0.2
        role: accuracy_review

      - name: skeptic
        model: claude-3-opus
        temperature: 0.5
        role: find_flaws

    thresholds:
      certified: 0.8
      provisional: 0.6
      unanimous_bonus: 0.1

  Scraping Config

  scraping:
    rate_limit:
      requests_per_second: 1
      burst: 5
      exponential_backoff: true

    stealth:
      user_agents: [list of real browser UAs]
      jitter_percent: 20
      warm_up_requests: 3

    error_handling:
      max_retries: 3
      skip_404: true
      backoff_429: true

  ---
  Data Structures

  Candidate Pattern

  interface CandidatePattern {
    id: string;
    source: {
      url: string;
      scraped_at: Date;
      scraper_version: string;
    };

    content: {
      name: string;
      description: string;
      problem: string;
      solution: string;
      steps: string[];
      conditions: Record<string, string>;
      examples: string[];
    };

    metadata: {
      domain: string;
      categories: string[];
      tags: string[];
      confidence: number;  // Extractor confidence
    };

    certification?: {
      status: 'pending' | 'certified' | 'rejected' | 'flagged';
      confidence: number;
      judge_scores: Record<string, number>;
      certified_at?: Date;
      issues?: string[];
    };
  }

  ---
  API Endpoints (For Supervisor)

  // Supervisor control
  POST   /api/supervisor/start
  POST   /api/supervisor/stop
  GET    /api/supervisor/status

  // Task management
  POST   /api/supervisor/assign
  GET    /api/supervisor/tasks
  GET    /api/supervisor/task/:id

  // Monitoring
  GET    /api/supervisor/heartbeat/:worker
  GET    /api/supervisor/focus/:worker
  POST   /api/supervisor/refocus/:worker

  // Certification
  POST   /api/certification/submit
  GET    /api/certification/status/:id
  GET    /api/certification/queue

  ---
  Next Steps

  1. Implement AI Supervisor - Generic interface to replace Claude Code dependency
  2. Build Certification Panel - Multi-AI consensus system
  3. Enhance Scraping - Add stealth and error handling
  4. Create Dashboard - Supervisor monitoring interface
  5. Define Human Escalation - When and how to involve humans
  6. Deploy Test Run - Autonomous 24-hour learning session

  ---
  Success Metrics
  ┌────────────────────────┬─────────┬────────┐
  │         Metric         │ Current │ Target │
  ├────────────────────────┼─────────┼────────┤
  │ Patterns/day (manual)  │ 5-10    │ 100+   │
  ├────────────────────────┼─────────┼────────┤
  │ Human review rate      │ 100%    │ <5%    │
  ├────────────────────────┼─────────┼────────┤
  │ Certification accuracy │ Unknown │ >90%   │
  ├────────────────────────┼─────────┼────────┤
  │ System uptime          │ Manual  │ 24/7   │
  ├────────────────────────┼─────────┼────────┤
  │ Scraping success rate  │ N/A     │ >80%   │
  └────────────────────────┴─────────┴────────┘
  ---
  Document Status: Ready for implementation planning

  Author: orangelightening with Claude
  Last Updated: 2026-01-12

✻ Worked for 2m 15s

❯ write that to self-learning-exframe.md and commit it
  ⎿  Interrupted · What should Claude do instead?

❯ You sre in the exframe-test directory so cd to development/eeframe and put the file in the right
  directory.

● Bash(ls -la /home/peter/development/eeframe/ 2>/dev/null | head -20 || echo "Directory not found, checking
      alternatives...")
  ⎿  Interrupted · What should Claude do instead?

❯ The working dir for this project is /home/peter/development/eeframe. cd back there and rewrite the
  document

● Bash(cd /home/peter/development/eeframe && pwd)
  ⎿  /home/peter/development/eeframe
  ⎿  Shell cwd was reset to /tmp/ExFrame-test

● Write(~/development/eeframe/self-learning-exframe.md)

───────────────────────────────────────────────────────────────────────────────────────────────────────────────
 Create file ../../home/peter/development/eeframe/self-learning-exframe.md
╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌
 # Self-Learning ExFrame - Architecture Document

 **Version**: 1.0
 **Date**: 2026-01-12
 **Status**: Design Proposal

 ---

 ## Executive Summary

 ExFrame can achieve near-autonomous operation through a multi-layered AI supervision system. The goal is
 **zero-touch pattern ingestion** - from web scraping to certified knowledge patterns - with human
 intervention only for audit and strategic direction.

 ### Key Insight

 Human review is the bottleneck. By implementing an **AI Certification Panel** and **AI Supervisor**, we
 create a closed-loop learning system that:
 - Scrapes autonomously (with stealth)
 - Certifies patterns through multi-AI consensus
 - Self-monitors for hallucination/focus drift
 - Requires humans only for exceptions and audit

 ---

 ## Architecture Overview

 ```
                                      HUMAN INTERFACE LAYER
                            (Audit + Strategic Direction Only)

                                                 │
                                                 ▼
                               ┌─────────────────────────────────────┐
                               │            AI SUPERVISOR            │
                               │  ┌─────────┐ ┌─────────┐ ┌───────┐ │
                               │  │Heartbeat│ │  Focus  │ │  Re-  │ │
                               │  │ Monitor │ │Detector │ │focus  │ │
                               │  └─────────┘ └─────────┘ └───────┘ │
                               └─────────────────────────────────────┘
                                                 │
                   ┌─────────────────────────────┼─────────────────────────────┐
                   ▼                             ▼                             ▼
         ┌───────────────────┐      ┌───────────────────┐      ┌───────────────────┐
         │    SCRAPING       │      │   CERTIFICATION   │      │     PATTERN       │
         │     ENGINE        │      │      PANEL        │      │    INGESTION      │
         │  ┌─────────────┐  │      │  ┌─────────────┐  │      │  ┌─────────────┐  │
         │  │  Stealth    │  │      │  │  AI Judge 1 │  │      │  │ Validation  │  │
         │  │ Rate Limit  │  │      │  │  AI Judge 2 │  │      │  │ De-dup     │  │
         │  │  Retry      │  │      │  │  AI Judge 3 │  │      │  └─────────────┘  │
         │  └─────────────┘  │      │  └─────────────┘  │      │                     │
         └───────────────────┘      └───────────────────┘      └───────────────────┘
                   │                             │                             │
                   └─────────────────────────────┼─────────────────────────────┘
                                                 ▼
                                 ┌─────────────────────────────────┐
                                 │     ExFrame Knowledge Base      │
                                 │     (Certified Patterns)         │
                                 └─────────────────────────────────┘
 ```

 ---

 ## Component Specifications

 ### 1. AI Supervisor

 The supervisor maintains system health and focus. Currently implemented via Claude Code, production version
 will use generic API.

 #### 1.1 Interface

 ```typescript
 interface AISupervisor {
   // Heartbeat - check if worker LLM is responsive
   heartbeat(workerId: string): Promise<HeartbeatStatus>;

   // Focus detection - detect drift, hallucination, loops
   monitorFocus(workerId: string, conversation: Conversation[]): Promise<FocusReport>;

   // Refocus - bring drifting LLM back on task
   refocus(workerId: string, intervention: Intervention): Promise<boolean>;

   // Task assignment - delegate work to specialized workers
   assignTask(workerId: string, task: SupervisorTask): Promise<TaskResult>;
 }

 interface HeartbeatStatus {
   isAlive: boolean;
   responseTime: number;
   lastActive: Date;
   state: 'active' | 'sleeping' | 'hung' | 'looping' | 'hallucinating';
 }

 interface FocusReport {
   isFocused: boolean;
   confidence: number;
   driftType: 'none' | 'repetition' | 'topic_drift' | 'hallucination' | 'giving_up';
   suggestion?: string;
 }
 ```

 #### 1.2 Focus Detection Heuristics

 | Symptom | Detection Method | Intervention |
 |---------|------------------|--------------|
 | Repetitive loops | Last N responses > 95% similar | Inject variation prompt |
 | Topic drift | Embedding distance from task > threshold | Restate context and goal |
 | Hallucination | Fact-check against known patterns | Flag for certification panel |
 | Giving up | "I can't" / refusal patterns | Reformulate task |
 | Sleeping | No response > timeout | Restart with context summary |
 | Hung | Response time > 2x normal | Interrupt and retry |

 #### 1.3 Refocus Strategies

 ```python
 class RefocusStrategy:
     @staticmethod
     def gentle_reminder(worker, task):
         """Mild drift - restate the goal"""
         return f"Let's focus on: {task.goal}. Current status: {task.status}"

     @staticmethod
     def context_reset(worker, task):
         """Moderate drift - reset with full context"""
         return f"""
 Task: {task.description}
 Goal: {task.goal}
 Constraints: {task.constraints}
 Progress so far: {task.progress_summary}
 Please continue from where we left off.
 """

     @staticmethod
     def hard_reset(worker, task):
         """Severe drift - start fresh with lessons learned"""
         return f"""
 We need to restart this task. Here's what we learned:
 {task.failures_summary}

 New approach: {task.alternative_strategy}
 Begin with this understanding in mind.
 """
 ```

 ---

 ### 2. Certification Panel

 Multi-AI consensus system for pattern validation. Eliminates single point of failure/bias.

 #### 2.1 Architecture

 ```
             Candidate Pattern
                     │
         ┌───────────┼───────────┐
         ▼           ▼           ▼
    ┌─────────┐ ┌─────────┐ ┌─────────┐
    │  AI 1   │ │  AI 2   │ │  AI 3   │
    │Generalist│ │Specialist│ │Skeptic │
    └────┬────┘ └────┬────┘ └────┬────┘
         │            │            │
         └────────┬───┴────────────┘
                  ▼
          ┌──────────────┐
          │ Consensus    │
          │ Engine       │
          └──────┬───────┘
                 │
       ┌─────────┼─────────┐
       ▼         ▼         ▼
   Certified   Flagged   Rejected
 ```

 #### 2.2 AI Judges

 | Judge | Role | Prompt Strategy | Output |
 |-------|------|-----------------|--------|
 | **Generalist** | Pattern structure review | "Is this a valid pattern?" | Binary + confidence |
 | **Specialist** | Domain accuracy | "Is this technically correct?" | Binary + confidence |
 | **Skeptic** | Find flaws | "What's wrong with this?" | Issues list |
 | **Integrator** (optional) | Cross-domain check | "Does this conflict with existing?" | Conflict report |

 #### 2.3 Certification Logic

 ```python
 class CertificationPanel:
     def certify_pattern(self, candidate: CandidatePattern) -> CertificationResult:
         reviews = []

         # Get reviews from each AI judge
         for judge in self.judges:
             review = yield from self._get_review(judge, candidate)
             reviews.append(review)

         # Calculate consensus
         consensus = self._calculate_consensus(reviews)

         # Skeptic veto
         skeptic_issues = next((r.issues for r in reviews if r.judge_type == 'skeptic'), [])
         if skeptic_issues and any(i.severity == 'critical' for i in skeptic_issues):
             return CertificationResult(status='rejected', reason=issues)

         # Decision matrix
         if consensus.average_confidence >= 0.8 and consensus.unanimous:
             return CertificationResult(status='certified', confidence=consensus.average_confidence)
         elif consensus.average_confidence >= 0.6:
             return CertificationResult(status='provisional', requires_human_review=False)
         else:
             return CertificationResult(status='flagged', requires_human_review=True)
 ```

 #### 2.4 Confidence Scoring

 ```python
 @dataclass
 class CertificationResult:
     status: Literal['certified', 'provisional', 'flagged', 'rejected']
     confidence: float  # 0.0 to 1.0
     judge_scores: Dict[str, float]
     issues: List[str] = field(default_factory=list)
     requires_human_review: boolean = False
     certification_date: datetime = field(default_factory=datetime.now)

     def __str__(self):
         return f"[{self.status.upper()}] {self.confidence:.1%} confidence"
 ```

 ---

 ### 3. Scraping Engine

 Autonomous web scraping with stealth and resilience.

 #### 3.1 Stealth Techniques

 | Technique | Implementation | Purpose |
 |-----------|----------------|---------|
 | **Rate limiting** | Exponential backoff, randomized delays | Avoid detection |
 | **User agent rotation** | Pool of realistic browser UAs | Appear as different clients |
 | **Proxy rotation** | Optional proxy pool for distributed requests | Avoid IP blocking |
 | **Request jitter** | Random timing within acceptable range | Defeat pattern detection |
 | **Warm-up** | Gradual increase from cold start | Mimic human behavior |

 #### 3.2 Error Handling

 ```python
 class ScrapingErrorStrategy:
     ERROR_RESPONSES = {
         404: 'skip',  # Resource doesn't exist, move on
         403: 'backoff_and_retry',  # Rate limited, wait
         429: 'exponential_backoff',  # Explicit rate limit
         500: 'retry_with_care',  # Server error, cautious retry
         503: 'backoff_long',  # Service unavailable, wait longer
     }

     async def handle_error(self, error, url, attempt):
         strategy = self.ERROR_RESPONSES.get(error.status, 'skip')
         match strategy:
             case 'skip':
                 logger.warning(f"Skipping {url}: {error.status}")
                 return SkipAction()
             case 'backoff_and_retry':
                 return BackoffAction(delay=2 ** attempt)
             case 'exponential_backoff':
                 return BackoffAction(delay=min(2 ** attempt * 5, 300))
             # ... more strategies
 ```

 #### 3.3 Scraping Supervisor

 ```python
 class ScrapingSupervisor:
     async def orchestrate_scraping(self, targets: List[ScrapeTarget]):
         """Manage multiple scraping workers with coordination"""
         queue = asyncio.Queue()

         # Enqueue targets with priority
         for target in targets:
             await queue.put(target)

         # Spawn workers
         workers = [
             asyncio.create_task(self._worker(queue, i))
             for i in range(self.concurrency)
         ]

         # Supervise
         await asyncio.gather(*workers)
 ```

 ---

 ### 4. Pattern Ingestion Pipeline

 From raw scrape to certified pattern.

 ```
 Raw HTML
    │
    ▼
 Extract → Structured Data (JSON candidate)
    │
    ▼
 Validate → Schema check, required fields
    │
    ▼
 De-duplicate → Similarity check against existing
    │
    ├──────────────┐
    ▼              ▼
 New       Duplicate → Merge/Update
    │
    ▼
 Certification Panel → Multi-AI review
    │
    ├────────┼────────┐
    ▼        ▼        ▼
 Certified Flagged Rejected
    │
    ▼
 Knowledge Base
 ```

 ---

 ## Human Intervention Points

 ### Current (High Intervention)
 - [ ] Manual pattern review
 - [ ] Manual scrape triggering
 - [ ] Manual data cleanup
 - [ ] Manual duplicate resolution
 - [ ] Manual error recovery

 ### Target (Minimal Intervention)

 | Point | Automation | Human Trigger | Human Action |
 |-------|-----------|---------------|--------------|
 | **Source selection** | AI discovers relevant sources | Strategic direction | "Focus on Python optimization"
  |
 | **Scraping** | Fully autonomous | N/A | N/A |
 | **Extraction** | AI + validation | N/A | N/A |
 | **Certification** | AI panel | Low confidence alerts | Review edge cases |
 | **Conflict resolution** | AI mediation | Unresolvable conflicts | Arbitrate |
 | **Quality audit** | AI continuous | Scheduled | Review reports |
 | **System failure** | AI recovery | Critical failures | Root cause analysis |

 ### Estimated Human Touch

 | Phase | Current | Target | Reduction |
 |-------|---------|--------|------------|
 | Ingestion | 100% | <1% | 99% |
 | Certification | 100% | <5% | 95% |
 | Maintenance | 100% | <10% | 90% |
 | **Overall** | **100%** | **<5%** | **95%** |

 ---

 ## AI Supervisor Implementation

 ### Test Phase (Claude Code)

 ```python
 # Current test setup uses Claude Code directly
 supervisor = ClaudeCodeSupervisor()
 supervisor.monitor_system()
 ```

 ### Production Phase (Generic Interface)

 ```python
 # Production uses generic API endpoint
 supervisor = GenericSupervisor(
     api_url="https://api.example.com/v1",
     api_key=os.getenv["SUPERVISOR_API_KEY"]
 )

 # Supervisor is LLM-agnostic
 # Can use OpenAI, Anthropic, or any compatible API
 ```

 ### Supervisor State Machine

 ```
                     ┌─────────────┐
                     │   IDLE      │
                     └──────┬──────┘
                            │
                    Task assigned
                            ▼
                     ┌─────────────┐
                     │  MONITORING │◄─────────┐
                     └──────┬──────┘          │
                            │                 │
                 ┌──────────┼──────────┐      │
                 ▼          ▼          ▼      │
             Normal    Drift    Failure      │
                 │          │          │      │
                 │          ▼          │      │
                 │    Refocus          │      │
                 │          │          │      │
                 └──────────┴──────────┘      │
                            │                 │
                     Task complete            │
                            ▼                 │
                     ┌─────────────┐          │
                     │  REPORTING  │──────────┘
                     └──────┬──────┘
                            │
                     ┌──────┴──────┐
                     ▼             ▼
                Success        Learn
                     │             │
                     └──────┬──────┘
                            ▼
                     ┌─────────────┐
                     │   IDLE      │
                     └─────────────┘
 ```

 ---

 ## Failure Modes and Recovery

 ### Supervisor Failure

 | Failure | Detection | Recovery |
 |---------|-----------|----------|
 | Supervisor crash | Watchdog process | Restart supervisor, restore state |
 | API unreachable | Health check | Failover to backup API |
 | Hallucination | Output validation | Rollback, log incident |

 ### Worker Failure

 | Failure | Detection | Recovery |
 |---------|-----------|----------|
 | Worker crash | No heartbeat | Restart worker, reassign task |
 | Worker stuck | Timeout | Terminate, restart with context |
 | Output garbage | Validation | Flag for human review |

 ### Certification Failure

 | Failure | Detection | Recovery |
 |---------|-----------|----------|
 | Judge disagreement | Consensus < threshold | Add fourth judge |
 | All judges reject | Unanimous rejection | Log pattern, skip |
 | Judge unavailable | API timeout | Use remaining judges, flag |

 ---

 ## Configuration

 ### Supervisor Config

 ```yaml
 supervisor:
   api:
     url: https://api.example.com/v1
     model: claude-3.5-sonnet
     max_tokens: 4096
     temperature: 0.7

   heartbeat:
     interval: 30  # seconds
     timeout: 10   # seconds
     max_missed: 3

   focus:
     window_size: 10  # messages to analyze
     drift_threshold: 0.3
     repetition_threshold: 0.95

   refocus:
     max_attempts: 3
     strategies: [gentle, context_reset, hard_reset]
 ```

 ### Certification Config

 ```yaml
 certification:
   judges:
     - name: generalist
       model: gpt-4
       temperature: 0.3
       role: structure_review

     - name: specialist
       model: claude-3.5-sonnet
       temperature: 0.2
       role: accuracy_review

     - name: skeptic
       model: claude-3-opus
       temperature: 0.5
       role: find_flaws

   thresholds:
     certified: 0.8
     provisional: 0.6
     unanimous_bonus: 0.1
 ```

 ### Scraping Config

 ```yaml
 scraping:
   rate_limit:
     requests_per_second: 1
     burst: 5
     exponential_backoff: true

   stealth:
     user_agents: [list of real browser UAs]
     jitter_percent: 20
     warm_up_requests: 3

   error_handling:
     max_retries: 3
     skip_404: true
     backoff_429: true
 ```

 ---

 ## Data Structures

 ### Candidate Pattern

 ```typescript
 interface CandidatePattern {
   id: string;
   source: {
     url: string;
     scraped_at: Date;
     scraper_version: string;
   };

   content: {
     name: string;
     description: string;
     problem: string;
     solution: string;
     steps: string[];
     conditions: Record<string, string>;
     examples: string[];
   };

   metadata: {
     domain: string;
     categories: string[];
     tags: string[];
     confidence: number;  // Extractor confidence
   };

   certification?: {
     status: 'pending' | 'certified' | 'rejected' | 'flagged';
     confidence: number;
     judge_scores: Record<string, number>;
     certified_at?: Date;
     issues?: string[];
   };
 }
 ```

 ---

 ## API Endpoints (For Supervisor)

 ```typescript
 // Supervisor control
 POST   /api/supervisor/start
 POST   /api/supervisor/stop
 GET    /api/supervisor/status

 // Task management
 POST   /api/supervisor/assign
 GET    /api/supervisor/tasks
 GET    /api/supervisor/task/:id

 // Monitoring
 GET    /api/supervisor/heartbeat/:worker
 GET    /api/supervisor/focus/:worker
 POST   /api/supervisor/refocus/:worker

 // Certification
 POST   /api/certification/submit
 GET    /api/certification/status/:id
 GET    /api/certification/queue
 ```

 ---

 ## Next Steps

 1. **Implement AI Supervisor** - Generic interface to replace Claude Code dependency
 2. **Build Certification Panel** - Multi-AI consensus system
 3. **Enhance Scraping** - Add stealth and error handling
 4. **Create Dashboard** - Supervisor monitoring interface
 5. **Define Human Escalation** - When and how to involve humans
 6. **Deploy Test Run** - Autonomous 24-hour learning session

 ---

 ## Success Metrics

 | Metric | Current | Target |
 |--------|---------|--------|
 | Patterns/day (manual) | 5-10 | 100+ |
 | Human review rate | 100% | <5% |
 | Certification accuracy | Unknown | >90% |
 | System uptime | Manual | 24/7 |
 | Scraping success rate | N/A | >80% |

 ---

 **Document Status**: Ready for implementation planning

 **Author**: orangelightening with Claude
 **Last Updated**: 2026-01-12

╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌
 Do you want to create self-learning-exframe.md?
 ❯ 1. Yes
   2. Yes, allow all edits in eeframe/ during this session (shift+tab)
   3. No

 Esc to cancel · Tab to add additional instructions

